<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>次元站 - 基于番组计划API的动漫平台</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- 引入Axios（处理网络请求） -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
    <!-- Tailwind配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7E22CE', // 主色-紫（动漫风格）
                        secondary: '#F472B6', // 辅色-粉
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        anime: ['"Noto Sans SC"', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .anime-card {
                @apply rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:scale-105 bg-dark text-light;
            }
            .btn-primary {
                @apply bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/80 transition-all;
            }
            .nav-item {
                @apply px-4 py-2 hover:text-primary transition-all cursor-pointer;
            }
            .content-container {
                @apply max-w-7xl mx-auto px-4 py-8;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-anime">
    <!-- 导航栏 -->
    <header class="sticky top-0 bg-white shadow-md z-50">
        <div class="content-container flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-tv text-3xl text-primary"></i>
                <h1 class="text-2xl font-bold text-dark">次元站</h1>
            </div>
            <!-- 搜索框 -->
            <div class="relative w-1/3 md:w-1/4">
                <input type="text" id="search-input" placeholder="搜索番剧/角色..." 
                    class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-primary">
                <button id="search-btn" class="absolute right-2 top-1/2 -translate-y-1/2 text-primary">
                    <i class="fa-solid fa-search"></i>
                </button>
            </div>
            <!-- 导航菜单 -->
            <nav class="hidden md:flex items-center gap-2">
                <div class="nav-item active">首页</div>
                <div class="nav-item" id="category-btn">分类</div>
                <div class="nav-item">排行榜</div>
                <div class="nav-item">我的收藏</div>
            </nav>
            <!-- 移动端菜单按钮 -->
            <button class="md:hidden text-dark text-2xl" id="menu-btn">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>
        <!-- 分类弹窗 -->
        <div id="category-modal" class="hidden fixed top-16 left-0 w-full bg-white shadow-lg z-40 py-4 px-8 grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="category-item py-2 hover:text-primary cursor-pointer" data-type="1">动画</div>
            <div class="category-item py-2 hover:text-primary cursor-pointer" data-type="2">漫画</div>
            <div class="category-item py-2 hover:text-primary cursor-pointer" data-type="3">游戏</div>
            <div class="category-item py-2 hover:text-primary cursor-pointer" data-type="4">小说</div>
        </div>
    </header>

    <!-- 轮播图（推荐番剧） -->
    <section class="bg-dark text-light">
        <div class="content-container py-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl md:text-2xl font-bold">热门推荐</h2>
                <a href="#" class="text-secondary hover:underline">查看更多</a>
            </div>
            <div class="carousel overflow-x-auto pb-4 gap-4 flex" id="carousel-container">
                <!-- 轮播内容由JS动态生成 -->
            </div>
        </div>
    </section>

    <!-- 番剧列表 -->
    <main class="content-container">
        <h2 class="text-xl md:text-2xl font-bold mb-6 text-dark">最新番剧</h2>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6" id="anime-list">
            <!-- 番剧卡片由JS动态生成 -->
        </div>
        <!-- 加载更多按钮 -->
        <div class="flex justify-center mt-10">
            <button id="load-more" class="btn-primary flex items-center gap-2">
                <span>加载更多</span>
                <i class="fa-solid fa-spinner fa-spin hidden" id="load-spinner"></i>
            </button>
        </div>
    </main>

    <!-- 番剧详情弹窗 -->
    <div id="detail-modal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
        <div class="bg-dark text-light rounded-lg w-full max-w-4xl max-h-[80vh] overflow-auto">
            <button id="close-modal" class="absolute top-4 right-4 text-white text-2xl bg-black/50 rounded-full w-10 h-10 flex items-center justify-center">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="grid grid-cols-1 md:grid-cols-3">
                <!-- 详情封面 -->
                <div class="p-4 md:col-span-1">
                    <img id="detail-cover" src="" alt="" class="w-full rounded-lg">
                    <div class="mt-4 flex justify-between items-center">
                        <span id="detail-score" class="text-yellow-400 font-bold"></span>
                        <span id="detail-type" class="bg-primary/70 px-2 py-1 rounded text-xs"></span>
                    </div>
                </div>
                <!-- 详情内容 -->
                <div class="p-4 md:col-span-2">
                    <h3 id="detail-title" class="text-2xl font-bold mb-2"></h3>
                    <p id="detail-subtitle" class="text-gray-400 mb-4"></p>
                    <div class="mb-4 grid grid-cols-2 gap-2 text-sm">
                        <div><span class="text-gray-400">集数：</span><span id="detail-eps"></span></div>
                        <div><span class="text-gray-400">开播：</span><span id="detail-date"></span></div>
                        <div><span class="text-gray-400">地区：</span><span id="detail-area"></span></div>
                        <div><span class="text-gray-400">标签：</span><span id="detail-tags"></span></div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-bold mb-2">剧情简介</h4>
                        <p id="detail-desc" class="text-gray-300 leading-relaxed"></p>
                    </div>
                    <button class="btn-primary w-full">开始观看</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-dark text-light py-8 mt-10">
        <div class="content-container text-center">
            <p>本网站数据来源于 <a href="https://bgm.tv/" class="text-primary hover:underline" target="_blank">番组计划(Bangumi)</a>，仅作学习使用，请勿商用</p>
            <p class="mt-2 text-gray-400">© 2025 次元站 - 所有番剧版权归原作者及发行商所有</p>
        </div>
    </footer>

    <script>
        // 全局变量
        let currentPage = 1;
        const PAGE_SIZE = 12;
        // 跨域代理配置（手机端专用，稳定不失效）
const PROXY_URL = 'https://cors-anywhere.herokuapp.com/';
const BANGUMI_API = PROXY_URL + 'https://bgm.tv/api/v0';
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', () => {
            initEvent(); // 初始化事件
            getCarouselData(); // 获取轮播图数据
            getAnimeList(currentPage, PAGE_SIZE); // 获取番剧列表
        });

        // 初始化所有事件监听
        function initEvent() {
            // 搜索按钮
            document.getElementById('search-btn').addEventListener('click', () => {
                const keyword = document.getElementById('search-input').value.trim();
                if (keyword) searchAnime(keyword);
            });
            // 搜索框回车
            document.getElementById('search-input').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') document.getElementById('search-btn').click();
            });
            // 分类按钮
            document.getElementById('category-btn').addEventListener('click', () => {
                document.getElementById('category-modal').classList.toggle('hidden');
            });
            // 分类项点击
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', () => {
                    const type = item.dataset.type;
                    getAnimeList(1, PAGE_SIZE, type);
                    document.getElementById('category-modal').classList.add('hidden');
                });
            });
            // 加载更多
            document.getElementById('load-more').addEventListener('click', () => {
                currentPage++;
                getAnimeList(currentPage, PAGE_SIZE);
            });
            // 关闭详情弹窗
            document.getElementById('close-modal').addEventListener('click', () => {
                document.getElementById('detail-modal').classList.add('hidden');
            });
            // 移动端菜单
            document.getElementById('menu-btn').addEventListener('click', () => {
                document.getElementById('category-modal').classList.toggle('hidden');
            });
            // 点击弹窗外部关闭
            document.getElementById('detail-modal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('detail-modal')) {
                    document.getElementById('detail-modal').classList.add('hidden');
                }
            });
        }

        // 获取轮播图数据（热门番剧）
        async function getCarouselData() {
            try {
                const res = await axios.get(`${BANGUMI_API}/subjects/popular?type=1`);
                const data = res.data;
                const carousel = document.getElementById('carousel-container');
                carousel.innerHTML = '';
                data.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'carousel-item w-48 sm:w-64 flex-shrink-0';
                    div.innerHTML = `
                        <img src="${item.images.large}" alt="${item.name}" class="w-full h-64 object-cover rounded-lg">
                        <p class="mt-2 text-center font-medium truncate">${item.name}</p>
                    `;
                    div.addEventListener('click', () => showDetail(item.id));
                    carousel.appendChild(div);
                });
            } catch (err) {
                console.error('轮播图数据获取失败：', err);
                alert('数据加载失败，请刷新页面');
            }
        }

        // 获取番剧列表
        async function getAnimeList(page, size, type = 1) {
            try {
                const spinner = document.getElementById('load-spinner');
                spinner.classList.remove('hidden');
                const res = await axios.get(`${BANGUMI_API}/subjects`, {
                    params: { type, page, limit: size, sort: 'id' }
                });
                const data = res.data;
                const list = document.getElementById('anime-list');
                if (page === 1) list.innerHTML = ''; // 第一页清空，后续追加
                data.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'anime-card';
                    card.innerHTML = `
                        <img src="${item.images.common}" alt="${item.name}" class="w-full h-48 object-cover">
                        <div class="p-3">
                            <h3 class="font-bold truncate">${item.name}</h3>
                            <p class="text-xs text-gray-400 mt-1 truncate">${item.name_cn || '暂无中文名'}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-yellow-400 text-xs font-bold">${item.rating.score || '暂无评分'}</span>
                                <span class="text-xs bg-gray-700 px-1 rounded">${item.eps || '0'}集</span>
                            </div>
                        </div>
                    `;
                    // 点击卡片查看详情
                    card.addEventListener('click', () => showDetail(item.id));
                    list.appendChild(card);
                });
            } catch (err) {
                console.error('番剧列表获取失败：', err);
                alert('番剧列表加载失败');
            } finally {
                document.getElementById('load-spinner').classList.add('hidden');
            }
        }

        // 搜索番剧
        async function searchAnime(keyword) {
            try {
                const res = await axios.get(`${BANGUMI_API}/search/subjects`, {
                    params: { q: keyword, type: 1, limit: 24 }
                });
                const data = res.data;
                const list = document.getElementById('anime-list');
                list.innerHTML = '';
                if (data.length === 0) {
                    list.innerHTML = '<div class="col-span-full text-center py-10 text-gray-500">暂无搜索结果</div>';
                    return;
                }
                data.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'anime-card';
                    card.innerHTML = `
                        <img src="${item.images.common}" alt="${item.name}" class="w-full h-48 object-cover">
                        <div class="p-3">
                            <h3 class="font-bold truncate">${item.name}</h3>
                            <p class="text-xs text-gray-400 mt-1 truncate">${item.name_cn || '暂无中文名'}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-yellow-400 text-xs font-bold">${item.rating.score || '暂无评分'}</span>
                                <span class="text-xs bg-gray-700 px-1 rounded">${item.eps || '0'}集</span>
                            </div>
                        </div>
                    `;
                    card.addEventListener('click', () => showDetail(item.id));
                    list.appendChild(card);
                });
            } catch (err) {
                console.error('搜索失败：', err);
                alert('搜索失败，请重试');
            }
        }

        // 显示番剧详情
        async function showDetail(id) {
            try {
                const res = await axios.get(`${BANGUMI_API}/subjects/${id}`);
                const data = res.data;
                // 填充详情数据
                document.getElementById('detail-cover').src = data.images.large;
                document.getElementById('detail-title').innerText = data.name;
                document.getElementById('detail-subtitle').innerText = data.name_cn || '暂无中文名';
                document.getElementById('detail-score').innerText = `评分：${data.rating.score || '暂无'}`;
                document.getElementById('detail-type').innerText = getTypeText(data.type);
                document.getElementById('detail-eps').innerText = data.eps || '未知';
                document.getElementById('detail-date').innerText = data.date || '未知';
                document.getElementById('detail-area').innerText = data.platform || '未知';
                document.getElementById('detail-tags').innerText = data.tags.map(tag => tag.name).join(' / ') || '暂无';
                document.getElementById('detail-desc').innerText = data.summary || '暂无剧情简介';
                // 显示弹窗
                document.getElementById('detail-modal').classList.remove('hidden');
            } catch (err) {
                console.error('详情获取失败：', err);
                alert('番剧详情加载失败');
            }
        }

        // 转换类型为中文
        function getTypeText(type) {
            const typeMap = { 1: '动画', 2: '漫画', 3: '游戏', 4: '小说' };
            return typeMap[type] || '未知';
        }
    </script>
</body>
</html>
